(async()=>{async function n(e){async function t(e){var n,t=document.querySelector(e);if(t instanceof HTMLCanvasElement)return t;let a;if(a=t instanceof HTMLImageElement?t:(n=t,await new Promise(e=>{let t=n.style.backgroundImage;var a;t&&((a=t.trim().match(/(?!^)".*?"/g))&&0!==a.length||(t=null),t=a[0].replaceAll('"',""));const c=new Image;c.onload=()=>e(c),c.src=t})))return(t=document.createElement("canvas")).width=a.naturalWidth,t.height=a.naturalHeight,t.getContext("2d").drawImage(a,0,0),t;throw Error("failed to get image element for "+e)}try{return(await t(e)).toDataURL("image/jpeg").split(";base64,")[1]}catch(e){return null}}let r=null;async function e(){var e,t,a=(e=100,await new Promise(t=>{let a=!1;const c=setInterval(async()=>{if(!a){a=!0;var e=await BG.exec("get_settings");if(e.textcaptcha_auto_solve){e=await n(e.textcaptcha_image_selector);if(e&&r!==e)return r=e,clearInterval(c),a=!1,t({image_data:e})}a=!1}},e)}))["image_data"],c=await BG.exec("get_settings");c.enabled&&c.textcaptcha_auto_solve&&({job_id:t,data:a}=await NopeCHA.post({captcha_type:IS_DEVELOPMENT?"ocr_dev":"ocr",image_data:[a],key:c.key}),a)&&0<a.length&&(c=document.querySelector(c.textcaptcha_input_selector))&&!c.value&&(c.value=a[0])}for(;;){await Time.sleep(1e3);var t=await BG.exec("get_settings");t&&t.enabled&&t.textcaptcha_auto_solve&&function(e){try{var t;return document.querySelector(e.textcaptcha_image_selector)?!(!(t=document.querySelector(e.textcaptcha_input_selector))||t.value):void 0}catch(e){}}(t)&&await e()}})();
